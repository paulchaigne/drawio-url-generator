<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Diagram Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
</head>
<body>
  <h1>Diagram Generator</h1>
  <textarea id="xmlInput" placeholder="Colle ici le XML du diagramme" rows="15" cols="80"></textarea><br>
  <button onclick="generateURL()">Générer le lien</button>
  <p id="output"></p>

  <script>
    function generateURL() {
      const xml = document.getElementById('xmlInput').value.trim();
      if (!xml) {
        alert("Veuillez coller du contenu XML.");
        return;
      }

      try {
        const xmlContent = `<mxfile><diagram name="Page-1" id="id">${xml}</diagram></mxfile>`;
        const utf8 = new TextEncoder().encode(xmlContent);
        const deflated = pako.deflateRaw(utf8);
        const base64 = btoa(String.fromCharCode.apply(null, deflated));
        const url = `https://viewer.diagrams.net/?lightbox=1&edit=_blank#R${base64}`;

        document.getElementById('output').innerHTML = `
          <p><strong>Lien généré :</strong></p>
          <textarea rows="3" cols="80" readonly>${url}</textarea><br>
          <a href="${url}" target="_blank">➡️ Ouvrir dans diagrams.net</a>
        `;
      } catch (e) {
        document.getElementById('output').innerText = "Erreur : " + e.message;
      }
    }
  </script>
</body>
</html>
